{{- /* KaTeX CSS (self-hosted) + copy-tex extension (CDN, deferred) */ -}}
<link rel="stylesheet" href="{{ "css/katex.min.css" | relURL }}">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" crossorigin="anonymous"></script>

{{- /* Header search (Pagefind loaded dynamically) */ -}}
<script defer src="{{ "js/header-search.js" | relURL }}"></script>

{{- /* Dropdown menu styles */ -}}
<style>
.header{overflow:visible !important}
.nav{overflow:visible !important}
.nav #menu{overflow:visible !important}
.nav #menu .dropdown{position:relative}
.nav #menu .dropdown-toggle{display:flex;align-items:center;gap:.25rem;cursor:pointer;font-size:inherit;color:var(--primary)}
.nav #menu .dropdown-arrow{transition:transform .2s ease}
.nav #menu .dropdown:hover .dropdown-arrow{transform:rotate(180deg)}
.nav #menu .dropdown-menu{position:absolute;top:100%;left:0;min-width:140px;padding:.5rem 0;margin-top:.25rem;background:var(--theme);border:1px solid var(--border);border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.1);opacity:0;visibility:hidden;transition:opacity .2s ease,visibility .2s ease;z-index:1000;list-style:none}
.nav #menu .dropdown:hover .dropdown-menu{opacity:1;visibility:visible}
.nav #menu .dropdown-menu li{margin:0;padding:0}
.nav #menu .dropdown-menu a{display:block;padding:.5rem 1rem;color:var(--primary);text-decoration:none;white-space:nowrap;font-size:14px}
.nav #menu .dropdown-menu a:hover{background:var(--tertiary)}
.nav #menu .dropdown-menu .active{font-weight:600}
[data-theme="dark"] .nav #menu .dropdown-menu{box-shadow:0 4px 12px rgba(0,0,0,.3)}
</style>

{{- /* Header search styles */ -}}
<style>
#header-search-container{position:relative;display:flex;align-items:center}
#header-search-input{width:180px;padding:.4rem .75rem;border:1px solid var(--border);border-radius:6px;background:var(--theme);color:var(--primary);font-size:14px;transition:border-color .2s,width .2s}
#header-search-input:focus{outline:none;border-color:var(--primary);width:240px}
#header-search-input::placeholder{color:var(--secondary)}
#header-search-results{position:absolute;top:100%;right:0;min-width:320px;max-height:400px;overflow-y:auto;margin-top:.5rem;padding:0;background:var(--theme);border:1px solid var(--border);border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.15);list-style:none;display:none;z-index:1001}
#header-search-results.active{display:block}
#header-search-results li{margin:0;padding:0;border-bottom:1px solid var(--border)}
#header-search-results li:last-child{border-bottom:none}
#header-search-results a{display:block;padding:.75rem 1rem;color:var(--primary);text-decoration:none}
#header-search-results a:hover,.header-search-focus{background:var(--tertiary)}
#header-search-results .search-title{font-weight:600;margin-bottom:.25rem}
#header-search-results .search-summary{font-size:.85rem;color:var(--secondary);overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}
#header-search-results .search-no-results{padding:.75rem 1rem;color:var(--secondary);font-style:italic}
[data-theme="dark"] #header-search-results{box-shadow:0 4px 12px rgba(0,0,0,.4)}
@media(max-width:768px){
#header-search-input{width:120px}
#header-search-input:focus{width:160px}
#header-search-results{min-width:280px;right:0}
}
</style>

{{- /* Knowls system - CSS inlined to eliminate render-blocking request */ -}}
<style>
.knowl{color:var(--primary);text-decoration:none;border-bottom:1px dotted var(--primary);cursor:pointer}
.knowl:hover{border-bottom-style:solid}
.knowl[aria-expanded="true"]{font-weight:600}
.knowl-panel{margin:1rem 0;padding:0;border-left:3px solid var(--primary);border-radius:0 8px 8px 0;overflow:hidden}
.knowl-content{padding:0;position:relative}
.knowl-header{display:flex;justify-content:space-between;align-items:center;padding:.75rem 1rem;background:var(--tertiary);border-bottom:1px solid var(--border)}
.knowl-header strong{font-size:.9rem;text-transform:uppercase;letter-spacing:.05em}
.knowl-header-buttons{display:flex;align-items:center;gap:.25rem}
.knowl-close{background:none;border:none;font-size:1.5rem;line-height:1;cursor:pointer;color:var(--primary);padding:0 .25rem}
.knowl-close:hover{opacity:.7}
.knowl-copy{background:none;border:none;font-size:1.4rem;line-height:1;cursor:pointer;color:var(--primary);padding:0 .25rem;transition:opacity .15s ease}
.knowl-copy:hover{opacity:.7}
.knowl-body{padding:1rem}
.knowl-body p:last-child{margin-bottom:0}
.knowl-footer{position:absolute;bottom:.5rem;right:.5rem}
.knowl-loading,.knowl-error{padding:1rem;color:var(--secondary);font-style:italic}
.knowl-error a{color:var(--primary)}
.knowl-panel .knowl-panel{margin-left:.5rem}
.knowl-depth-even{background:var(--theme)}
.knowl-depth-odd{background:var(--code-bg)}
[data-theme="dark"] .knowl-depth-even{background:var(--entry)}
[data-theme="dark"] .knowl-depth-odd{background:var(--theme)}
@media print{
.knowl{color:#000;border-bottom:none;font-weight:600}
.knowl-panel{border:1px solid #000;border-left:3px solid #000;background:none;break-inside:avoid}
.knowl-header-buttons,.knowl-loading,.knowl-error,.knowl-footer{display:none}
.knowl-header{background:none;border-bottom:1px solid #ccc}
.knowl-depth-even,.knowl-depth-odd{background:none}
}
</style>
<script defer src="{{ "js/knowls.js" | relURL }}"></script>
{{- if .Params.knowlsOpen }}
<script>
// Auto-expand all knowls on page load
document.addEventListener('DOMContentLoaded', function() {
  // Small delay to ensure knowls.js is ready
  setTimeout(function() {
    document.querySelectorAll('.knowl').forEach(function(knowl) {
      if (knowl.getAttribute('aria-expanded') !== 'true') {
        knowl.click();
      }
    });
  }, 100);
});
</script>
{{- end }}
